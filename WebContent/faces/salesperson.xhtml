<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:p="http://primefaces.org/ui"
	  >
	  <f:metadata>
	  	<f:event type="preRenderView" listener="#{scheduleController.reload}" />
	  </f:metadata>
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title></title>

	<style>
		.message {
			display: block;
			font-family: Arial;
			padding: 5px;
			margin: 0 0 10px;
			white-space: pre;
		}
		.info {
			background-color: #dff0d8;
		}
		.error {
			background-color: #f2dede;
		}
		.main {
			padding: 20px;
		}
		.alert {
			display: block;
			font-family: Arial;
			padding: 15px;
			margin-bottom: 20px;
			border: 1px solid transparent;
			border-radius: 4px;
		}
		.alert-warning {
			color: #8a6d3b;
			background-color: #fcf8e3;
			border-color: #faebcc;
		}
		.alert-info {
			 color: #3c763d;
			 background-color: #dff0d8;
			 border-color: #d6e9c6;
		}
		.alert-danger {
			 color: #a94442;
			 background-color: #f2dede;
			 border-color: #ebccd1;
		}
		body {
			padding: 15px;
			margin-bottom: 20px;
		}
		.newMsg {
			background-color: #ffef8f;
		}
	</style>
</h:head>
<h:body>
	<h:form id="form01">
		<p:menubar>
			<p:menuitem value="Dashboard" url="#{sessionController.dashboardLink}" />
			<p:submenu label="Products Catalog" >
				<p:menuitem style="color: blue;" value="AutoCAD" url="../products/AutoCAD.jsf" />
				<p:menuitem style="color: blue;" value="QuickDesk" url="../products/quickdesk.jsf" />
				<p:menuitem style="color: blue;" value="Revit" url="../products/Revit.jsf" />
				<p:menuitem style="color: blue;" value="Stormworks" url="../products/Stormworks.jsf" />
			</p:submenu>
			<p:menuitem value="Products" url="../faces/products.jsf" />
			<p:menuitem value="Feedback" url="../customers/customers.jsf" />
			<p:menuitem value="Customers" url="../faces/companyList.jsf" />
			<p:menuitem value="Expense" url="../faces/expense.jsf" />
			<p:submenu label="Reports">
				<p:menuitem value="Call Report" url="../faces/calls.jsf" />
				<p:menuitem value="Add call report" url="../faces/callReport.jsf" />
			</p:submenu>
			<p:menuitem value="Notes" url="../faces/notes.jsf" />
			<p:menuitem value="LOG OUT" style="float: right" action="#{scheduleController.logout}" immediate="true" update="form01" />
		</p:menubar>

		<h:messages infoClass="alert alert-info" fatalClass="alert alert-danger" errorClass="alert alert-danger" warnClass="alert alert-warning"/>
		<br/>
		<p:outputPanel id="firstMessage">
			<a href="#form01:tbl3">You have <span class="badge badge-success">#{scheduleController.newNotes}</span> unread message(s).</a>
		</p:outputPanel>

		<p:fieldset legend="Your sale misson">
			<p:panelGrid columns="3">
				<h:outputText value="Your sale target" />
				<h:outputText value="#{scheduleController.std.target}" />
				<h:outputText value="" />
				<h:outputText value="Your current sale record" />
				<h:outputText value="#{scheduleController.std.current} (#{scheduleController.percentage} %)" />
				<p:menuButton value="Actions">
					<p:menuitem value="See all sale activities" url="activity.jsf" />
					<p:menuitem value="Find company" url="companyList.jsf" target="_blank" />
				</p:menuButton>
				<h:outputText value="From" />
				<h:outputText value="#{scheduleController.std.fromDate}">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</h:outputText>
				<h:outputText value="" />

				<h:outputText value="To" />
				<h:outputText value="#{scheduleController.std.toDate}">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</h:outputText>
				<h:outputText value="" />

			</p:panelGrid>
		</p:fieldset>

		<p:panel id="toggleable" header="Schedule Today" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" widgetVar="panel" style="margin-bottom:20px">
			<p:dataTable id="tbl2" rowIndexVar="row" value="#{scheduleController.events}" var="event"
					paginator="true" paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink}"
					rows="8">
				<p:column headerText="From">
					<h:outputText value="#{event.from}">
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
					</h:outputText>
				</p:column>
				<p:column headerText="To">
					<h:outputText value="#{event.to}">
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
					</h:outputText>
				</p:column>
				<p:column headerText="Detail">
					<h:outputText value="#{event.detail}" />
				</p:column>
				<p:column headerText="Customer">
					<h:outputText value="#{event.customer.name}" />
				</p:column>
				<p:column headerText="Action">
					<p:commandButton value="Delete" actionListener="#{scheduleController.remove(event)}" update=":form01" />
					<a href="editEvent.jsf?seq=#{event.seq}">Edit</a>
				</p:column>
			</p:dataTable>
	        <f:facet name="options">
	            <p:menu>
	                <p:submenu label="Settings">
	                    <p:menuitem value="Toggle" url="#" icon="ui-icon-newwin" onclick="PF('panel').toggle()" />
	                </p:submenu>
	            </p:menu>
	        </f:facet>
	        <br/>
	        <p:commandButton value="Add new meeting" actionListener="#{scheduleController.startAddMeeting}" update=":form01"/>
    	</p:panel>

		<p:panel id="tasks" header="Task today" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" widgetVar="tasksPanel" style="margin-bottom:20px">
			<p:dataTable id="taskTbl" rowIndexVar="row" value="#{scheduleController.tasks}" var="task"
					paginator="true" paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink}"
					rows="15" >
				<p:column headerText="Category">
					<h:outputText value="#{task.category}" />
				</p:column>
				<p:column headerText="Customer">
					<h:outputText value="#{task.customer.name}" />
				</p:column>
				<p:column headerText="Time">
					<h:outputText value="#{task.time}">
						<f:convertDateTime pattern="HH:mm" />
					</h:outputText>
				</p:column>
				<p:column headerText="Detail">
					<h:outputText value="#{task.detail}" />
				</p:column>
				<p:column headerText="Action">
					<p:commandButton value="Delete" actionListener="#{scheduleController.deleteTask(task)}" update=":form01:tasks" />
					<p:commandButton value="Edit" actionListener="#{scheduleController.startEditTask(task)}" update=":form01" />
					<p:commandButton value="Create new sale activity" actionListener="#{scheduleController.startAddNewAct(task)}" update=":form01" />
				</p:column>
			</p:dataTable>
			<br/>
			<p:commandButton value="Add new task" actionListener="#{scheduleController.startAddTask}" update=":form01"/>
		</p:panel>

    	<h4 style="font-family: Helvetica;">Add new meeting</h4>
   		<p:dialog id="newMeetingDialog" closable="false" visible="#{scheduleController.addMeetingMode}"
				widgetVar="newMeetingDialog_w" modal="true" resizable="false" draggable="true" header="">
			<p:messages />
			<p:panelGrid columns="2">
				<h:outputText value="From" />
				<p:calendar value="#{scheduleController.from}" pattern="MM/dd/yyyy HH:mm" />
				<h:outputText value="To" />
				<p:calendar value="#{scheduleController.to}" pattern="MM/dd/yyyy HH:mm" />
				<h:outputText value="Title" />
				<p:inputText value="#{scheduleController.title}" />
				<h:outputText value="Company" />
				<p:autoComplete forceSelection="true" value="#{scheduleController.companyName}" minQueryLength="3" maxResults="10" completeMethod="#{scheduleController.suggestCompany}" />
			</p:panelGrid>
			<p:commandButton value="Add" actionListener="#{scheduleController.addNewEvent}" update=":form01" />
			<p:commandButton value="Cancel" actionListener="#{scheduleController.cancelAddMeeting}" update=":form01" />
		</p:dialog>


		<h4 style="font-family: Helvetica;">Your messages</h4>
		<p:dataTable id="tbl3" rowIndexVar="row" value="#{scheduleController.notes}" var="note"
				paginator="true" paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink}"
				rows="7" rowStyleClass="#{note.status == 'UNREAD'? 'newMsg' : null}">
			<p:column headerText="From">
				<h:outputText value="#{note.fromUser.name}" />
			</p:column>
			<p:column headerText="To">
				<h:outputText value="#{note.toUser.name}" />
			</p:column>
			<p:column headerText="Date">
				<h:outputText value="#{note.createdDate}">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</h:outputText>
			</p:column>
			<p:column headerText="Note">
				<h:outputText value="#{note.note}" rendered="#{productController.noteLink(note) == ''}" />
				<h:outputLink value="#{productController.noteLink(note)}" rendered="#{productController.noteLink(note) != ''}" style="color: blue">#{note.note}</h:outputLink>
			</p:column>
			<p:column>
				<p:commandButton value="Mark as read" actionListener="#{scheduleController.markRead(note)}" update=":form01:tbl3, :form01:firstMessage" rendered="#{note.status == 'UNREAD'}" />
				<p:commandButton value="Respond" actionListener="#{scheduleController.startRespond(note)}" update=":form01" />
			</p:column>
		</p:dataTable>

		<p:dialog id="denyDialog" closable="false" visible="#{scheduleController.respondMode}"
				widgetVar="denyDialog_w" modal="true" resizable="false" draggable="true" header="Message">
			<p:messages />
			<p:panelGrid columns="2">
				<h:outputText value="Message" />
				<p:inputTextarea value="#{scheduleController.responseDetail}" />
			</p:panelGrid>
			<br/>
			<p:commandButton value="Send" actionListener="#{scheduleController.respond}" update=":form01"/>
			<p:commandButton value="Cancel" actionListener="#{scheduleController.cancelRespond}" update=":form01"/>
		</p:dialog>

		<p:dialog id="addTaskDialog" closable="false" visible="#{scheduleController.addTaskMode}"
				widgetVar="addTaskDialog_w" modal="true" resizable="false" draggable="true" header="Add new task">
			<p:messages />
			<p:panelGrid columns="2">
				<h:outputText value="Action" />
				<p:inputText value="#{scheduleController.newTask.category}" />

				<h:outputText value="Time" />
				<p:calendar value="#{scheduleController.newTask.time}" pattern="dd/MM/yyy HH:mm" />

				<h:outputText value="Customer" />
				<p:autoComplete forceSelection="true" value="#{scheduleController.companyName_2}" minQueryLength="3" maxResults="10" completeMethod="#{scheduleController.suggestCompany}" />

				<h:outputText value="Detail" />
				<p:inputTextarea value="#{scheduleController.newTask.detail}" />

			</p:panelGrid>
			<p:commandButton value="Add" actionListener="#{scheduleController.addNewTask}" update=":form01"/>
			<p:commandButton value="Cancel" actionListener="#{scheduleController.cancelAddTask}" update=":form01"/>
		</p:dialog>

		<p:dialog id="editTaskDialog" closable="false" visible="#{scheduleController.editTaskMode}"
				widgetVar="editTaskDialog_w" modal="true" resizable="false" draggable="true" header="Edit Task">
			<p:panelGrid columns="2">
				<h:outputText value="Action" />
				<p:inputText value="#{scheduleController.editingTask.category}" />

				<h:outputText value="Customer" />
				<h:outputText value="#{scheduleController.editingTask.customer.name}" />

				<h:outputText value="Time" />
				<p:calendar value="#{scheduleController.editingTask.time}" pattern="dd/MM/yyyy HH:mm" />

				<h:outputText value="Detail" />
				<p:inputText value="#{scheduleController.editingTask.detail}" />
			</p:panelGrid>
			<p:commandButton value="Confirm" actionListener="#{scheduleController.editTask}" update=":form01" />
			<p:commandButton value="Cancel" actionListener="#{scheduleController.cancelEditTask}" update=":form01" />
		</p:dialog>

		<p:dialog id="newActDialog" closable="false" visible="#{scheduleController.addActivityMode}"
				widgetVar="newActDialog_w" modal="true" resizable="false" draggable="true" header="Add new activity">
			<p:panelGrid columns="2">
				<h:outputText value="Customer" />
				<h:outputText value="#{scheduleController.newAct.customer.name}" />

				<h:outputText value="Start date" />
				<p:calendar value="#{scheduleController.newAct.startDate}" pattern="dd/MM/yyyy" />

				<h:outputText value="Status" />
				<h:outputText value="Contacted" />

				<h:outputText value="Remark" />
				<p:inputTextarea value="#{scheduleController.newAct.remark}" />
			</p:panelGrid>
			<p:commandButton value="Add" actionListener="#{scheduleController.addNewAct}" update=":form01"/>
			<p:commandButton value="Cancel" actionListener="#{scheduleController.cancelAddNewAct}" update=":form01"/>
		</p:dialog>
	</h:form>
</h:body>
</html>